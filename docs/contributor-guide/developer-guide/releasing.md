# Releasing

See [Upgrading to a New Release](it-manual/sre-playbook/upgrading-to-a-new-release.md) for an overview of CiviForm release practices.

Releases are created once a month by the on-call engineer, and more often if requested by a civic entity (e.g. for an urgent bugfix).

## Creating a new release

### 1. Find the most recent commit that is passing CI for all staging environments:

* [Seattle staging](https://staging.seattle.civiform.com/)
* [staging-azure](https://staging-azure.civiform.dev/)
* [staging-AWS](https://staging-aws.civiform.dev/)

### 2. Run the script to create a new release

The release can either be run as [a GitHub action](https://github.com/civiform/civiform/actions/workflows/release.yaml) (recommended) or from your [local machine](https://github.com/civiform/civiform/blob/main/bin/create-release) (if the GitHub action is not working).

When you run the script, pass the commit SHA from step 1 and the new release number as arguments. If you are uncertain what the new release number is, confer with other members of the CiviForm core team.

The release script:

1. Validates the commit SHA is a commit on main and RELEASE_NUMBER matches the convention
1. Tags the git commit with the release number, annotated with description that includes the email address of the release caller, and pushes it to github
1. Pulls the existing server image from Docker Hub (identified by the commit SHA), tags it with the release number and pushes it to Docker Hub
1. Calls the GitHub API to create a new draft release
1. Prints the GH URL to the draft release


### 3. Edit the generated draft release

Follow the GitHub URL to the draft release printed at the end of the script from the previous step, or navigate to [the repo's releases page](https://github.com/civiform/civiform/releases) and find the new draft release.

Next, edit the release notes to include the following:

- Description of fixed bugs
- Description of new features
- Database schema changes
- Other stateful changes (such as stored file key name schema)
- API version changes and deprecation notices
- New configuration values
- Infrastructure changes
- Dependency changes (for the server only) including new, removed, and version updates

Every pull request that is relevant to the release should have a `Release notes` section in its description, use this if the autogenerated description for a given PR is not adequate.

### Publish the release and email all stakeholders

Once the release notes are looking good, publish the draft release and then email the release notes to civiform-technical@googlegroups.com
